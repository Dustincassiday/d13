<ng-container *ngIf="vm$ | async as vm">
  <d13-layout [vm]="vm" (loginBtnClick)="handleOpenModal(login)" (logoutBtnClick)="handleLogout()"
    (signupBtnClick)="handleOpenModal(signup)">
    <router-outlet main-content></router-outlet>
  </d13-layout>

  <!-- MODALS -->
  <ng-template #login let-modal>
    <d13-login-modal [modalRef]="modal" [alerts]="vm.errors" (newUserBtnClick)="handleOpenModal(signup)"
      (forgotPasswordBtnClick)="handleOpenModal(passwordReset)" (closeModal)="handleCloseModal()"
      (loginBtnClick)="loginForm.submit()">
      <d13-login-form #loginForm (formSubmit)="handleLoginFormSubmit($event)"></d13-login-form>
    </d13-login-modal>
  </ng-template>

  <ng-template #signup let-modal>
    <d13-signup-modal [modalRef]="modal" [alerts]="vm.errors" (loginBtnClick)="handleOpenModal(login)"
      (signupBtnClick)="signUpForm.submit()" (closeModal)="handleCloseModal()">
      <d13-signup-form #signUpForm (formSubmit)="handleSignupFormSubmit($event)"></d13-signup-form>
    </d13-signup-modal>
  </ng-template>

  <ng-template #passwordReset let-modal>
    <d13-password-reset-modal [modalRef]="modal" (closeModal)="handleCloseModal()">
      <d13-password-reset-form #passwordResetForm (formSubmit)="handlePasswordResetFormSubmit($event)">
      </d13-password-reset-form>
    </d13-password-reset-modal>
  </ng-template>
</ng-container>